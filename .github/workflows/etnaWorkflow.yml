name: Etna CI CD
on: [push]


env:
  CPPUTEST_HOME: ${{ secrets.CPPUTEST_HOME }}



before_jobs:
  - name: DockerHub Login
    uses: docker/login-action@v2.1.0
    with:
      username: ${{ secrets.DOCKER_USERNAME }}
      password: ${{ secrets.DOCKER_TOKEN }}

jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: dawidblom/etna:latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Build
      run: |
        docker run --rm -v $(pwd):/project -w /project dawidblom/etna:latest bash -c "scripts/Build.sh Release"
      env:
        CPPUTEST_HOME: ${{ env.CPPUTEST_HOME }}

          # StaticCodeAnalysis:
          #    runs-on: ubuntu-latest
          #    steps:
          #    - name: Checkout Code
          #      uses: actions/checkout@v3
          #        
          #    - name: Static Code Analysis
          #      run: |
          #        docker run --rm -v $(pwd):/project -w /project dawidblom/etna:latest bash -c "scripts/Build.sh StaticAnalysis"
          #      env:
          #        CPPUTEST_HOME: ${{ env.CPPUTEST_HOME }}
          #        
          #
          # UnitTests:
          #    runs-on: ubuntu-latest
          #    steps:
          #    - name: Checkout Code
          #      uses: actions/checkout@v3
          #
          #    - name: Unit Tests
          #      run: |
          #        docker run --rm -v $(pwd):/project -w /project dawidblom/etna:latest bash -c "scripts/Build.sh UnitTest"
          #      env:
          #        CPPUTEST_HOME: ${{ env.CPPUTEST_HOME }}
          #
          # CodeCoverage:
          #    runs-on: ubuntu-latest
          #    steps:
          #    - name: Checkout Code
          #      uses: actions/checkout@v3
          #
          #    - name: Code Coverage
          #      run: |
          #        docker run --rm -v $(pwd):/project -w /project dawidblom/etna:latest bash -c "scripts/Build.sh CodeCoverage"
          #      env:
          #        CPPUTEST_HOME: ${{ env.CPPUTEST_HOME }}

